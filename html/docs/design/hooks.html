<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="/images/favicon.ico">

    <title>Taskwarrior - What's next?</title>

    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/site.css" rel="stylesheet">
    <link href="/docs/docs.css" rel="stylesheet">

    <!--[if lt IE 9]><script src="/bootstrap/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="navbar navbar-default navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <a class="navbar-brand text-heavy" href="/"><img src="/images/tw-s.png" width="24" height="24"> TASKWARRIOR</a>
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="/news/">News</a></li>
            <li class="active"><a href="/docs/">Docs</a></li>
            <li><a href="/download/">Download</a></li>
            <li><a href="/support/">Support</a></li>
            <li><a href="/tools/">Tools</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="col-md-10">
        <div class="col-md-2">
        </div>

        <div class="col-md-10 main">
          <div class="row">
            <div class="callout callout-danger">
              <h4>Draft</h4>
              <p>
                This is a draft design document. Your feedback is welcomed.
              </p>
            </div>

            <a name="hooks"></a>
            <h3>Hooks</h3>
            <p>
              A hook system is a way to call out to other programs/scripts
              at certain points in Taskwarrior's execution, so that processing
              can be influenced. These callout points correspond to locations
              in the code where some critical processing is occurring.
            </p>

            <p>
              When certain Taskwarrior code is executed, a program/script is
              run, and when it completes, Taskwarrior resumes. We call this a
              hook script being triggered by an event. Data is passed between
              Taskwarrior and the hook script.
            </p>

            <p>
              The hook scripts may be written in any suitable programming
              language, which means they will need to read from standard input,
              write to standard output, optionally parse JSON, and exit with a
              specific status code.
            </p>

            <p>
              There is no configuration required for the hook scripts - their
              presence and accessibility is all that is required.
            </p>

            <a name="events"></a>
            <h4>Events</h4>
            <p>
              Hooks are triggered by events, and the list of supported events
              is kept delibrately short.

              <table class="table table-striped table-compact">
                <tr>
                  <td><code>on-launch</code></td>
                  <td>
                    This event is triggered at launch, after the initialization
                    of all data structures, but before any processing. This
                    event provides an opportunity to prevent launch.
                  </td>
                </tr>
                <tr>
                  <td><code>on-exit</code></td>
                  <td>
                    This event is triggered after all processing, but immediately
                    before output is shown, which is the last opportunity to run
                    and contribute output.
                  </td>
                </tr>
                <tr>
                  <td><code>on-add</code></td>
                  <td>
                    This event is triggered when a new task is created, after
                    the data has been processed, but before the task is saved.
                    This event provides an opportunity to deny the creation of
                    the task, or modify it.
                  </td>
                </tr>
                <tr>
                  <td><code>on-modify</code></td>
                  <td>
                    This event is triggered when an existing task is modified,
                    after the data has been read and processed, but before the
                    task is saved. This event provides an opportunity to deny
                    the modification of the task, or further modify it.
                  </td>
                </tr>
              </table>

              Task completion and deletion are considered modifications.
            </p>

            <a name="git"></a>
            <h4>The Git Model</h4>
            <p>
              Following the Git model, a hook script need only exist in a
              specific location, possess a recognizable name, and be executable.
            </p>

            <p>
              The location for hooks scripts is by default
              <code>~/.task/hooks</code>, which is itself defined by the
              <code>rc.data.location</code> setting. A hook script must either
              reside in this location, or be symbolically linked into this
              location.

              The name of the hook script should be of the form:
            </p>

            <pre>&lt;event&gt;[&lt;identifier&gt;]</pre>

            <p>
              Some examples being:
            </p>

            <pre>on-add
on-add.01
on-add-require-project</pre>

            <p>
              The event in the name indicates when the script is run and must
              exactly match the event name. The optional identifier allows for
              multiple scripts processing the same event, easy identificaton
              from the name, and a defined order of execution.
            </p>

            <p>
              When there are multiple scripts for the same event, the order of
              execution is the collating sequence of the script name.

              A hook script can be disabled by simply removing execute
              permission.
            </p>

            <a name="interfaces"></a>
            <h4>Interfaces</h4>
            <p>
              The hook scripts have different responsibilities, depending on
              the type of hook. Some are provided with JSON, some are expected
              to indicate that processing should continue or stop. All can
              provide error messages.
            </p>

            <h5>Interface: <code>on-launch</code></h5>
            <p>
              This event triggers once on launch.
              If a task is added/modified it <em>will</em> trigger other events.

              <table class="table table-striped table-compact">
                <tr>
                  <td>Input</td>
                  <td>Nothing is provided on stdin</td>
                </tr>
                <tr>
                  <td>Output</td>
                  <td>
                    <ul>
                      <li>All emitted JSON lines must be fully-formed tasks, one per line.</li>
                      <li>All emitted non-JSON lines are considered feedback messages.</li>
                    </ul>
                  </td>
                </tr>
                <tr>
                  <td>Exit Code</td>
                  <td>
                    0 Means:
                    <ul>
                      <li>all emitted JSON lines are added/modifiied</li>
                      <li>all emitted non-JSON lines become footnote entries</li>
                    </ul>
                    1 Means:
                    <ul>
                      <li>all emitted JSON lines are ignored</li>
                      <li>all emitted non-JSON lines become error entries</li>
                    </ul>
                  </td>
                </tr>
              </table>
            </p>

            <h5>Interface: <code>on-exit</code></h5>
            <p>
              The on-exit event is triggered once, after all processing is
              complete
              No tasks are modified by this event.

              <table class="table table-striped table-compact">
                <tr>
                  <td>Input</td>
                  <td>A read-only line of JSON for each task added/modified</td>
                </tr>
                <tr>
                  <td>Output</td>
                  <td>
                    <ul>
                      <li>All emitted JSON lines must be fully-formed tasks, one per line.</li>
                      <li>All emitted non-JSON lines are considered feedback messages.</li>
                    </ul>
                  </td>
                </tr>
                <tr>
                  <td>Exit Code</td>
                  <td>
                    0 Means:
                    <ul>
                      <li>all emitted non-JSON lines become footnote entries</li>
                    </ul>
                    1 Means:
                    <ul>
                      <li>all emitted non-JSON lines become error entries</li>
                    </ul>
                  </td>
                </tr>
              </table>
            </p>

            <h5>Interface: <code>on-add</code></h5>
            <p>
              The on-add event is triggered separately for each task added.
              If a task is added/modified it <em>will</em> trigger other events.

              <table class="table table-striped table-compact">
                <tr>
                  <td>Input</td>
                  <td>A line of JSON for the task added</td>
                </tr>
                <tr>
                  <td>Output</td>
                  <td>
                    <ul>
                      <li>All emitted JSON lines must be fully-formed tasks, one per line.</li>
                      <li>All emitted non-JSON lines are considered feedback messages.</li>
                    </ul>
                  </td>
                </tr>
                <tr>
                  <td>Exit Code</td>
                  <td>
                    0 Means:
                    <ul>
                      <li>all emitted JSON lines are added/modifiied</li>
                      <li>all emitted non-JSON lines become footnote entries</li>
                    </ul>
                    1 Means:
                    <ul>
                      <li>all emitted JSON lines are ignored</li>
                      <li>all emitted non-JSON lines become error entries</li>
                    </ul>
                  </td>
                </tr>
              </table>
            </p>

            <h5>Interface: <code>on-modify</code></h5>
            <p>
              The on-modify event is triggered separately for each task added
              or modified.
              If a task is added/modified it <em>will</em> trigger other events.

              <table class="table table-striped table-compact">
                <tr>
                  <td>Input</td>
                  <td>
                    <ul>
                      <li>A line of JSON for the original task</li>
                      <li>A line of JSON for the modified task</li>
                    </ul>
                  </td>
                </tr>
                <tr>
                  <td>Output</td>
                  <td>
                    <ul>
                      <li>All emitted JSON lines must be fully-formed tasks, one per line.</li>
                      <li>All emitted non-JSON lines are considered feedback messages.</li>
                    </ul>
                  </td>
                </tr>
                <tr>
                  <td>Exit Code</td>
                  <td>
                    0 Means:
                    <ul>
                      <li>all emitted JSON lines are added/modifiied</li>
                      <li>all emitted non-JSON lines become footnote entries</li>
                    </ul>
                    1 Means:
                    <ul>
                      <li>all emitted JSON lines are ignored</li>
                      <li>all emitted non-JSON lines become error entries</li>
                    </ul>
                  </td>
                </tr>
              </table>
            </p>


            <a name="impact"></a>
            <h4>Impact</h4>
            <p>
              The hook system is visible in other ways:

              <ul>
                <li>
                  The <code>diagnostics</code> command will enumerate hook
                  scripts, indicating that the script is executable. This will
                  help when diagnosing hook problems.
                </li>

                <li>
                  In debug mode (<code>rc.debug=1</code>) the hook scripts run
                  will be listed with their exit status and run time.
                </li>

                <li>
                  In debug mode (<code>rc.debug=1</code>) all hook scripts will
                  be timed, and the cumulative time indicated. It is anticipated
                  that hook scripts will have a longer run time than Taskwarrior,
                  and this should be measured.
                </li>
              </ul>
            </p>

            <a name="safety"></a>
            <h4>Safety</h4>
            <p>
              With any hook system there are potential problems which involve
              race conditions, infinite loops and runaway cascading effects.
              Various measures are taken to mitigate these problems.
            </p>

            <p class="bg-danger">
              Except there aren't any yet, but there need to be some, once they
              are identified. To be completed.
            </p>

            <a name="examples"></a>
            <h4>Examples</h4>
            <p>
              Here are some example uses for hooks. These are not intended to
              represent good ideas, but represent a variety of needs.
              <ol>
                <li>Policy enforcement: referencing issues, description length, project values</li>
                <li>Shadow files</li>
                <li>User defined special tags</li>
                <li>Automatic priority escalation</li>
                <li>Automated data backup</li>
                <li>Making certain tasks read-only</li>
                <li>Disabling features like recurrence or priorities</li>
                <li>Spell-checking</li>
                <li>Preventing use of profanity</li>
                <li>Performing a sync on launch</li>
              </ol>
            </p>
          </div>
        </div>
      </div>

      <div class="col-md-2">
        <div class="alert alert-warning">
          <ul class="list-unstyled">
            <li><a class="alert-link" href="#hooks">Hooks</a></li>
            <li><a class="alert-link" href="#events">Events</a></li>
            <li><a class="alert-link" href="#git">The Git Model</a></li>
            <li><a class="alert-link" href="#interfaces">Interfaces</a></li>
            <li><a class="alert-link" href="#impact">Impact</a></li>
            <li><a class="alert-link" href="#safety">Safety</a></li>
            <li><a class="alert-link" href="#examples">Examples</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div id="footer">
      <div class="container">
        <div class="col-md-2">
          <p class="text-muted">
            Get Involved
            <br />
            <a href="https://bug.tasktools.org/secure/CreateIssue!default.jspa">Submit a bug</a>
            <br />
            <a href="https://git.tasktools.org/projects/TM/repos/task/browse">Clone the code</a>
          </p>
        </div>
        <div class="col-md-2">
          <p class="text-muted">
            Monitor
            <br />
            <a href="http://status.tasktools.org">System status</a>
            <br />
            <a href="http://statuspage.tasktools.org">Operations Information</a>
          </p>
        </div>
        <div class="col-md-2">
          <p class="text-muted">
            Related Sites
            <br />
            <a href="http://tasktools.org">tasktools.org</a>
            <br />
            <a href="http://flod.us/index2.html">flod.us</a>
            <br />
            <a href="http://holidata.net">holidata.net</a>
          </p>
        </div>
        <div class="col-md-2">
          <p class="text-muted">
            Contact
            <br />
            <a href="mailto:support@taskwarrior.org"><span class="glyphicon glyphicon-envelope"></span> Email</a>
            <br />
            <a href="https://twitter.com/taskwarrior"><img src="/images/twitter_dark.png" width="16px" height="16px"> Twitter</a>
            <br />
            <a href="http://taskwarrior.org/+"><img src="/images/google_dark.png" width="16px" height="16px"> G+</a>
            <br />
            <a href="http://taskwarrior.wordpress.com/"><img src="/images/wordpress.png" width="16px" height="16px"> Blog</a>
          </p>
        </div>
        <div class="col-md-2">
          <p class="text-muted">
            Donate
            <br />
            <a href="https://flattr.com/submit/auto?user_id=taskwarrior&url=http%3A%2F%2Ftaskwarrior.org" target="_blank"><span class="glyphicon"><img src="/images/flattr_logo_16.png" width="16px" height="16px" alt="Flattr this" title="Flattr this" border="0"></span> Flattr</a>
            <br />
            <form action="https://www.paypal.com/cgi-bin/webscr" method="post">
              <input type="hidden" name="cmd" value="_s-xclick">
              <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----">
              <input type="image" src="/images/paypal.jpg" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
              <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
            </form>
          </p>
        </div>
        <div class="col-md-2">
          <p class="text-muted">
            Copyright &copy; 2014 <a href="/about.html">GÃ¶teborg Bit Factory</a>
          </p>
        </div>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>

    <!-- Piwik -->
    <script type="text/javascript">
      var _paq = _paq || [];
      _paq.push(["trackPageView"]);
      _paq.push(["enableLinkTracking"]);

      (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://see.tasktools.org/piwik/";
        _paq.push(["setTrackerUrl", u+"piwik.php"]);
        _paq.push(["setSiteId", "1"]);
        var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
        g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Piwik Code -->
  </body>
</html>
